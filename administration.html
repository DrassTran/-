<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./JS/jquery.min.js"></script>
    <link rel="stylesheet" href="./bootstrap-3.4.1-dist/css/bootstrap.css">
    <script src="./bootstrap-3.4.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="./iconfont/Âõæ‰π¶ÂíåÊéíË°åÊ¶úÊúçÂä°Âô®Â≠ó‰Ωì/font_qizqwal6edr/iconfont.css">
    <link rel="stylesheet" href="./layui-v2.6.11/layui/css/layui.css">
    <link rel="stylesheet" href="./CSS/administration.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-inverse  header-background">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand font-color" href="./index main.html">‰∏âÂë≥‰π¶Â±ã</a>
                </div>

                <!-- ÊêúÁ¥¢Ê°ÜÁöÑÂÜÖÂÆπü•Åü•Åü•Å-->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <form class="navbar-form navbar-left search-move">
                        <!-- ÂàõÂª∫Â§¥ÈÉ®ÂØºËà™Ê†èÁöÑÊêúÁ¥¢Ê°Ü üó°Ô∏è-->
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="ËØ∑ËæìÂÖ•‰π¶Âêç" style="width: 300px;">
                        </div>
                        <!-- ÂàõÂª∫ÊêúÁ¥¢Ê°ÜÈáåÁöÑÊèê‰∫§ÊåâÈíÆü•∞ü•∞ü•∞-->
                        <button type="submit" class="btn btn-default headerbtn"><span
                                class="glyphicon glyphicon-search"></span></button>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#" class="font-color"><span class="iconfont icon-tushu"
                                    id="iconfont-tushu"></span>‰π¶Á±çÁÆ°ÁêÜ</a></li>
                        <li><a href="#" class="font-color">
                                <span class="iconfont icon-paihangbang--" id="iconfont-paihang"></span> ÊéíË°åÊ¶ú</a></li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
    </header>
    <!-- ÁªôÊï¥‰∏™‰π¶Á±çÁÆ°ÁêÜÊ∑ªÂä†‰∏Ä‰∏™Â§ßÁõíÂ≠ê -->
    <div class="admin-content">
        <!-- ‰π¶Á±çÁÆ°ÁêÜÁöÑË°®Ê†ºüëªüëªüëª -->
        <table class="layui-hide" id="demo" lay-filter="demo"></table>
    </div>
    <!-- ÁΩëÈ°µÂ∫ïÈÉ®ÊïàÊûúü¶∂ -->
    <footer>
        <p>¬© 2022 ‰∏âÂë≥‰π¶Â±ã ÈöêÁßÅÊîøÁ≠ñ ‰∫¨ICPËØÅ080268Âè∑ ‰∫¨ICPÂ§á10005211Âè∑</p>
    </footer>
    <!-- ÁÇπÂáªÊñ∞Â¢ûÂá∫Êù•Ê®°ÊÄÅÊ°Ü -->
    <div id="model1">
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <label class="layui-form-label">‰π¶Âêç</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" placeholder="ËØ∑ËæìÂÖ•‰π¶Âêç"
                        autocomplete="off" class="layui-input" id="titleinput">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">Â∞ÅÈù¢Âõæ</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" placeholder="ËØ∑ËæìÂÖ•Â∞ÅÈù¢ÂõæÂØπÂ∫îÁöÑURL"
                        autocomplete="off" class="layui-input" id="imgurl">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">‰ΩúËÄÖ</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" placeholder="ËØ∑ËæìÂÖ•‰ΩúËÄÖ"
                        autocomplete="off" class="layui-input" id="authorinput">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" id="pingfen">ËØÑÂàÜ</label>
                <div>
                    <div id="test8" class="star"></div><span id="fenshu1"></span><span id="fen1">ÂàÜ</span>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">ÁÆÄ‰ªã</label>
                <div class="layui-input-block">
                    <textarea name="desc" placeholder="ËØ∑ËæìÂÖ•ÂÜÖÂÆπ" class="layui-textarea" id="descinput"></textarea>
                </div>
            </div>
        </form>
    </div>
    <!-- ÁªôÁºñËæë‰∫ã‰ª∂ËÆæÁΩÆÁöÑÊ®°ÊÄÅÊ°Ü -->
    <div id="model2">
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <label class="layui-form-label">‰π¶Âêç</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" autocomplete="off"
                        class="layui-input" id="titleinput2">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">Â∞ÅÈù¢Âõæ</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" autocomplete="off"
                        class="layui-input" id="imgUrl1">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">‰ΩúËÄÖ</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" autocomplete="off"
                        class="layui-input" id="authorinput2">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" id="pingfen2">ËØÑÂàÜ</label>
                <div>
                    <div id="star2" class="star"></div><span id="fenshu2"></span><span id="fen2">ÂàÜ</span>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">ÁÆÄ‰ªã</label>
                <div class="layui-input-block">
                    <textarea name="desc" class="layui-textarea" id="descinput2"></textarea>
                </div>
            </div>
        </form>
    </div>
</body>

<script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">Ëé∑ÂèñÈÄâ‰∏≠Êï∞ÁõÆ</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">È™åËØÅÊòØÂê¶ÂÖ®ÈÄâ</button>
        <!-- Êñ∞Â¢û üëªüëªüëª-->
        <button class="layui-btn layui-btn-sm" lay-event="add">Êñ∞Â¢û</button>
    </div>
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">ÁºñËæë</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">Âà†Èô§</a>
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">Êü•Áúã</a>
</script>
<script src="./layui-v2.6.11/layui/layui.js"></script>
<script src="./JS/axios.min.js"></script>
<script>
    let titleinput2 = document.querySelector("#titleinput2")
    let authorinput2 = document.querySelector("#authorinput2")
    let descinput2 = document.querySelector("#descinput2")
    let imgUrl1 = document.querySelector("#imgUrl1")
    async function fun() {
        try {
            let { data: gen } = await axios.get("http://localhost:3005/books?_sort=rate&_order=desc&_start=0");
            // console.log(gen.data);

            layui.use('table', function () {
                var table = layui.table;
                //Ë°åÂ∑•ÂÖ∑‰∫ã‰ª∂
                table.on('tool(demo)', function (obj) {
                    var data = obj.data;
                    console.log(data)
                    titleinput2.value = data.name;
                    authorinput2.value = data.author;
                    descinput2.value = data.desc;
                    imgUrl1.value = data.coverImg;
                    if (obj.event === 'del') {
                        layer.confirm('ÁúüÁöÑÂà†Èô§Ë°å‰πà', function (index) {
                            obj.del();
                            layer.close(index);
                            console.log(index);
                            let { data: del } = axios.delete("http://localhost:3005/books/" + data.id).then(data => {
                                console.log(data);
                            })
                        });
                    } else if (obj.event === 'edit') {
                        //ÊòüÊòü
                        layui.use(['rate'], function () {
                            var rate = layui.rate;
                            let obj = {};
                            var ins1 = rate.render({
                                elem: '#star2'
                                , length: 10,
                                value: 0,
                                half: true,
                                readonely: true,
                                choose: value => {
                                    $("#fenshu2").text(value)
                                    // console.log(value);
                                }
                            });
                        })
                        layer.open({
                            type: 1,
                            skin: 'layui-layer-rim', //Âä†‰∏äËæπÊ°Ü
                            area: ['750px', '700px'], //ÂÆΩÈ´ò
                            content: $('#model2'),
                            btn: ["Á°ÆËÆ§", "ÂèñÊ∂à"],
                            //ÁªôÁºñËæëÊåâÈíÆÈáåÁöÑÁ°ÆÂÆöÊåâÈíÆ‰∏éAJAXÁõ∏ËøûÂπ∂Ê∏≤ÊüìÂà∞È°µÈù¢üåàüåàüåà
                            yes: function (index, layero) {
                                if ($("#titleinput2").val() === "" || $("#authorinput2").val() === "" || $("#imgur2").val() === "") {
                                    return
                                } else {
                                    //ÁºñËæëÂäüËÉΩ
                                    axios({
                                        method: "put",
                                        url: "http://localhost:3005/books/" + data.id,
                                        data: {
                                            name: $("#titleinput2").val(),
                                            author: $("#authorinput2").val(),
                                            desc: $("#descinput2").val(),
                                            rate: +$("#fenshu2").text(),
                                            coverImg: $("#imgUrl1").val(),
                                        },
                                    }).then(data => {
                                        console.log('11111111111', data.data);
                                    })
                                }
                                window.location.href = "./administration.html"
                            }
                        });
                        layer.title("ÁºñËæë")
                    }
                    //ÁªôÊü•ÁúãËÆæÁΩÆÈ°µÈù¢Ë∑≥ËΩ¨üêüüêüüêü
                    else if (obj.event === 'detail') {
                        window.location.assign('./books.html?id=' + data.id)
                    }
                });
                //Â±ïÁ§∫Â∑≤Áü•Êï∞ÊçÆ
                function render() {
                    table.render({
                        elem: '#demo',
                        toolbar: '#toolbarDemo' //ÂºÄÂêØÂ§¥ÈÉ®Â∑•ÂÖ∑Ê†èÔºåÂπ∂‰∏∫ÂÖ∂ÁªëÂÆöÂ∑¶‰æßÊ®°Êùø
                        , defaultToolbar: ['filter', 'exports', 'print',]
                        , title: '‰π¶Á±çÁÆ°ÁêÜ', cols: [[ //Ê†áÈ¢òÊ†è
                            { type: 'checkbox' }
                            , { field: 'name', title: '‰π¶Âêç', width: 140, unresize: true, sort: true },
                            {
                                field: 'coverImg', title: 'Â∞ÅÈù¢Âõæ', width: 220, templet: function (url) {
                                    return `<img src=${url.coverImg} >`
                                }
                            }
                            , { field: 'author', title: '‰ΩúËÄÖ', width: 180, edit: 'text' }
                            , { field: 'desc', title: 'ÁÆÄ‰ªã', width: 320, edit: 'text' }
                            , {
                                field: 'rate', title: 'ËØÑÂàÜ', width: 400, sort: true, templet: function (d) {
                                    let i = d.LAY_INDEX
                                    layui.use('rate', function () {
                                        // console.log("111111111111111", d.rate);
                                        var rate = layui.rate;
                                        //Ê∏≤Êüì
                                        let obj = {}
                                        var ins1 = rate.render({
                                            elem: '.bookXing' + i  //ÁªëÂÆöÂÖÉÁ¥†
                                            , length: 10
                                            , half: true
                                            , value: d.rate
                                            , readonly: true,
                                        });
                                    });
                                    i++
                                    return `<div class = "bookXing${i}"></div>`
                                }
                            }
                            , { title: 'Êìç‰Ωú', toolbar: '#barDemo', width: 200 },
                        ]]
                        , data: gen.data
                        //,skin: 'line' //Ë°®Ê†ºÈ£éÊ†º
                        , even: true
                        , page: true //ÊòØÂê¶ÊòæÁ§∫ÂàÜÈ°µ
                        , limits: [5, 10, 15, 20]
                        , limit: 5 //ÊØèÈ°µÈªòËÆ§ÊòæÁ§∫ÁöÑÊï∞Èáè
                    });
                    //Â§¥Â∑•ÂÖ∑Ê†è‰∫ã‰ª∂
                    table.on('toolbar(demo)', function (obj) {
                        var checkStatus = table.checkStatus(obj.config.id);
                        switch (obj.event) {
                            case 'getCheckLength':
                                var data = checkStatus.data;
                                layer.msg('ÈÄâ‰∏≠‰∫ÜÔºö' + data.length + ' ‰∏™');
                                break;
                            case 'isAll':
                                layer.msg(checkStatus.isAll ? 'ÂÖ®ÈÄâ' : 'Êú™ÂÖ®ÈÄâ');
                                break;
                        };
                        // ÁªôÈ°µÈù¢Ê∑ªÂä†Êñ∞Â¢ûÊåâÈíÆüòùüòùüòù
                        if (obj.event === "add") {
                            //ÊòüÊòü
                            layui.use(['rate'], function () {
                                var rate = layui.rate;
                                let obj = {};
                                var ins1 = rate.render({
                                    elem: '#test8'
                                    , length: 10
                                    , //ÂàùÂßãÂÄº
                                    half: true,
                                    readonely: true,
                                    choose: value => {
                                        $("#fenshu1").text(value)
                                    }
                                });
                            })
                            //È°µÈù¢Â±Ç
                            layer.open({
                                type: 1,
                                skin: 'layui-layer-rim', //Âä†‰∏äËæπÊ°Ü
                                area: ['750px', '700px'], //ÂÆΩÈ´ò
                                content: $('#model1'),
                                btn: ["Á°ÆËÆ§", "ÂèñÊ∂à"],
                                //ÁªôÊñ∞Â¢ûÊåâÈíÆÈáåÁöÑÁ´ãÂç≥Êèê‰∫§ÊåâÈíÆ‰∏éAJAXÁõ∏ËøûÂπ∂Ê∏≤ÊüìÂà∞È°µÈù¢üåàüåàüåà
                                yes: function (index, layero) {
                                    if ($("#titleinput").val() === "" || $("#authorinput").val() === "" || $("#imgurl").val() === "") {
                                        return
                                    } else {
                                        //ÊåâÈíÆ„ÄêÁ°ÆËÆ§ÊåâÈíÆ„ÄëÁöÑÂõûË∞É‚õ≤‚õ≤‚õ≤
                                        axios({
                                            method: "post",
                                            url: `http://localhost:3005/books`,
                                            data: {
                                                name: $("#titleinput").val(),
                                                author: $("#authorinput").val(),
                                                desc: $("#descinput").val(),
                                                coverImg: $("#imgurl").val(),
                                                rate: +$("#fenshu1").text(),
                                            }
                                        }).then(data => {
                                            console.log(data.data);
                                        })
                                        window.location.href = "./administration.html"
                                    }
                                }
                            });
                            layer.title("Êñ∞Â¢û");
                        }
                    });

                }
                render();
            });
        } catch (e) {
            console.log(e);
        }
    }
    fun()

    /* ÊØÅÁÅ≠ÂêßËØ•Ê≠ªÁöÑÈ°µÈù¢„ÄÇ
        üíÄüíÄüíÄüíÄüíÄüíÄ     
        üíÄ          üíÄ
        üíÄ          üíÄ           
        üíÄüíÄüíÄüíÄüíÄüíÄ             
        üíÄ          üíÄ   
        üíÄ          üíÄ           
        üíÄ          üíÄ                     
        üíÄüíÄüíÄüíÄüíÄüíÄ            
    
    */
</script>


</html>